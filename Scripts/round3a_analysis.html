<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="July Pilowsky">

<title>mgsim: Round 3a Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="round3a_analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="round3a_analysis_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="round3a_analysis_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="round3a_analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="round3a_analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="round3a_analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="round3a_analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="round3a_analysis_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="round3a_analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="round3a_analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="round3a_analysis_files/libs/bootstrap/bootstrap-bb4ae3cbdb7666cafb6ef5e9f69aabfc.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="round3a_analysis_files/libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="round3a_analysis_files/libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="round3a_analysis_files/libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#what-is-my-goal-in-round-3a-of-simulation" id="toc-what-is-my-goal-in-round-3a-of-simulation" class="nav-link active" data-scroll-target="#what-is-my-goal-in-round-3a-of-simulation">What is my goal in Round 3a of simulation?</a></li>
  <li><a href="#validation-metric-performance" id="toc-validation-metric-performance" class="nav-link" data-scroll-target="#validation-metric-performance">Validation Metric Performance</a>
  <ul class="collapse">
  <li><a href="#presence-in-dc" id="toc-presence-in-dc" class="nav-link" data-scroll-target="#presence-in-dc">Presence in DC</a></li>
  <li><a href="#other-validation-metrics" id="toc-other-validation-metrics" class="nav-link" data-scroll-target="#other-validation-metrics">Other Validation Metrics</a></li>
  </ul></li>
  <li><a href="#selected-models" id="toc-selected-models" class="nav-link" data-scroll-target="#selected-models">Selected models</a>
  <ul class="collapse">
  <li><a href="#posterior-distributions" id="toc-posterior-distributions" class="nav-link" data-scroll-target="#posterior-distributions">Posterior Distributions</a></li>
  </ul></li>
  <li><a href="#is-it-time-to-stop-modeling" id="toc-is-it-time-to-stop-modeling" class="nav-link" data-scroll-target="#is-it-time-to-stop-modeling">Is it time to stop modeling?</a>
  <ul class="collapse">
  <li><a href="#what-does-the-best-validated-ensemble-model-get-wrong" id="toc-what-does-the-best-validated-ensemble-model-get-wrong" class="nav-link" data-scroll-target="#what-does-the-best-validated-ensemble-model-get-wrong">What does the best validated ensemble model get wrong?</a></li>
  </ul></li>
  <li><a href="#time-series" id="toc-time-series" class="nav-link" data-scroll-target="#time-series">Time Series</a></li>
  <li><a href="#prevalence-animations" id="toc-prevalence-animations" class="nav-link" data-scroll-target="#prevalence-animations">Prevalence Animations</a>
  <ul class="collapse">
  <li><a href="#weighted-ensemble-average" id="toc-weighted-ensemble-average" class="nav-link" data-scroll-target="#weighted-ensemble-average">Weighted Ensemble Average</a></li>
  <li><a href="#simulation-7649" id="toc-simulation-7649" class="nav-link" data-scroll-target="#simulation-7649">Simulation 7649</a></li>
  <li><a href="#simulation-9673" id="toc-simulation-9673" class="nav-link" data-scroll-target="#simulation-9673">Simulation 9673</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">mgsim: Round 3a Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>July Pilowsky </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyplots)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(paletteer)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(abc)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayestestR)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qs2)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(epizootic)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multicore)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"Scripts/validation_metric_functions.R"</span>))</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"Scripts/convenience_functions.R"</span>))</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"Scripts/animate_sim.R"</span>))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"Scripts/pp_check.R"</span>))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set_trust_promises</span>(<span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>region <span class="ot">&lt;-</span> <span class="fu">qread</span>(<span class="fu">here</span>(<span class="st">"Data/Input/finch_region.qs"</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>round2_metrics <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/round2c_validation_metrics.csv"</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>trend_metrics2 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/round2c_trend_metrics.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"metric"</span>, <span class="st">"sim"</span>), <span class="at">names_sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">."</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>round2_metrics<span class="sc">$</span>hm_trend_1970[round2_metrics<span class="sc">$</span>dc] <span class="ot">&lt;-</span> trend_metrics2 <span class="sc">|&gt;</span> <span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">"penalty1970"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(value)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>round2_metrics<span class="sc">$</span>hm_trend_1993[round2_metrics<span class="sc">$</span>dc] <span class="ot">&lt;-</span> trend_metrics2 <span class="sc">|&gt;</span> <span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">"penalty1993"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(value)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>round1_priors <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"Data/Input/sample_data_round1.csv"</span>))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>round1_metrics <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/round1_validation_metrics.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hm_trend_1970 =</span> <span class="fu">rep</span>(<span class="cn">NA_real_</span>), <span class="at">hm_trend_1993 =</span> <span class="fu">rep</span>(<span class="cn">NA_real_</span>))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>round1_metrics<span class="sc">$</span>hm_trend_1970[round1_metrics<span class="sc">$</span>dc] <span class="ot">&lt;-</span> round1_metrics<span class="sc">$</span>hm_trend[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">9752</span>, <span class="dv">2</span>)]</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>round1_metrics<span class="sc">$</span>hm_trend_1993[round1_metrics<span class="sc">$</span>dc] <span class="ot">&lt;-</span> round1_metrics<span class="sc">$</span>hm_trend[<span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">9752</span>, <span class="dv">2</span>)]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>round2_priors <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"Data/Input/sample_data_round2b.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mortality_Sa_summer =</span> round1_priors<span class="sc">$</span>mortality_Sa_summer,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">mortality_Ra_summer =</span> mortality_Sa_summer)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>round3a_priors <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"Data/Input/sample_data_round3a.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mortality_Sa_summer =</span> round1_priors<span class="sc">$</span>mortality_Sa_summer,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">mortality_Ra_summer =</span> mortality_Sa_summer)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>round3a_metrics <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/round3a_validation_metrics.csv"</span>))</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>trend_metrics3a <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"Data/Validation/round3a_trend_metrics.csv"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"metric"</span>, <span class="st">"sim"</span>), <span class="at">names_sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">."</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>round3a_metrics<span class="sc">$</span>hm_trend_1970[round3a_metrics<span class="sc">$</span>dc] <span class="ot">&lt;-</span> trend_metrics3a <span class="sc">|&gt;</span> <span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">"penalty1970"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(value)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>round3a_metrics<span class="sc">$</span>hm_trend_1993[round3a_metrics<span class="sc">$</span>dc] <span class="ot">&lt;-</span> trend_metrics3a <span class="sc">|&gt;</span> <span class="fu">filter</span>(metric <span class="sc">==</span> <span class="st">"penalty1993"</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(value)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>finch_region <span class="ot">&lt;-</span> <span class="st">"Data/Input/finch_region.qs"</span> <span class="sc">|&gt;</span> <span class="fu">here</span>() <span class="sc">|&gt;</span> <span class="fu">qread</span>()</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>region_raster <span class="ot">&lt;-</span> finch_region<span class="sc">$</span>region_raster</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>region_raster[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(raster<span class="sc">::</span><span class="fu">values</span>(region_raster)))] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="what-is-my-goal-in-round-3a-of-simulation" class="level1">
<h1>What is my goal in Round 3a of simulation?</h1>
<p>My goal is to improve over Rounds 1 and 2 on the validation metrics, and to determine whether the posteriors have stabilized and I can stop simulating.</p>
</section>
<section id="validation-metric-performance" class="level1">
<h1>Validation Metric Performance</h1>
<section id="presence-in-dc" class="level2">
<h2 class="anchored" data-anchor-id="presence-in-dc">Presence in DC</h2>
<p>To start with, let’s look at presence of finches in DC. In the first round, 4876 simulations out of 10000 simulated the presence of house finches in Washington, DC in 1994, and in Round 2, it was 6992 out of 10000.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(round3a_metrics<span class="sc">$</span>dc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3140</code></pre>
</div>
</div>
<p>3,140 simulations have birds present in DC, which is worse than the two previous rounds. Ouch. Let me examine again which parameter settings make simulations pass this filter or not:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>round3a_priors <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dc =</span> round3a_metrics<span class="sc">$</span>dc) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>mortality_Sa_summer, <span class="sc">-</span>mortality_Ra_summer) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>, <span class="at">names_to =</span> <span class="st">"Prior"</span>, <span class="at">values_to =</span> <span class="st">"Value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Value, <span class="at">group =</span> dc, <span class="at">fill =</span> dc)) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Prior, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_paletteer_d</span>(<span class="st">"PrettyCols::Light"</span>, <span class="at">name =</span> <span class="st">"Birds in DC?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/dc-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="round3a_analysis_files/figure-html/dc-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>The controls on what passes the DC filter or not are different from Round 1. In Round 1, it had to do entirely with dispersal_target_n_k, maximizing the range of population densities that the finches were willing to migrate to. In this round, that’s already been optimized, so instead we’re selecting for low quasi-extinction threshold, higher fecundity, intermediate juvenile dispersal distance, and widening dispersal_source_n_k (the range of population densities that will push finches out and toward dispersal.)</p>
</section>
<section id="other-validation-metrics" class="level2">
<h2 class="anchored" data-anchor-id="other-validation-metrics">Other Validation Metrics</h2>
<p>Moving on I can look at the other validation metrics:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>validation_metrics <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(round1_metrics, round2_metrics, round3a_metrics) <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mutate</span>(<span class="at">Round =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"1"</span>, <span class="dv">10000</span>), <span class="fu">rep</span>(<span class="st">"2"</span>, <span class="dv">10000</span>), <span class="fu">rep</span>(<span class="st">"3a"</span>, <span class="dv">10000</span>)))) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">filter</span>(dc) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">select</span>(<span class="sc">-</span>hm_trend, <span class="sc">-</span>index, <span class="sc">-</span>dc)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>quantiles <span class="ot">&lt;-</span> validation_metrics[,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>] <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(\(x) <span class="fu">quantile</span>(x, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.001</span>), <span class="at">na.rm =</span> T))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Mycoplasma presence"</span>, <span class="st">"Finch pres/abs"</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Point prevalence"</span>, <span class="st">"Mycoplasma arrival"</span>, <span class="st">"Finch arrival"</span>,</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Finch trend from 1970"</span>, <span class="st">"Finch trend from 1993"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>plotlist <span class="ot">&lt;-</span> <span class="fu">pmap</span>(<span class="fu">list</span>(<span class="fu">names</span>(validation_metrics)[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>], quantiles, labels), <span class="cf">function</span>(x, y, z) {</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    outliers_removed <span class="ot">&lt;-</span> validation_metrics[, <span class="fu">c</span>(x, <span class="st">"Round"</span>)][<span class="fu">pull</span>(validation_metrics, x) <span class="sc">&lt;</span> <span class="fu">quantile</span>(<span class="fu">pull</span>(validation_metrics, x), <span class="fl">0.95</span>, <span class="at">na.rm=</span>T), ]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="at">data =</span> outliers_removed, <span class="fu">aes</span>(<span class="at">x =</span> .data[[x]], <span class="at">fill =</span> Round, <span class="at">group =</span> Round)) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> y, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(z) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_paletteer_d</span>(<span class="st">"PNWColors::Sunset2"</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plotlist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/validation_metrics_plot-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="round3a_analysis_files/figure-html/validation_metrics_plot-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Performance has improved on the metrics used for ABC (<em>Mycoplasma</em> presence and finch first arrival) and also on metrics that were not used for validation (finch presence/absence, finch trend from 1993.)</p>
</section>
</section>
<section id="selected-models" class="level1">
<h1>Selected models</h1>
<p>I will continue with the same two metrics used in the previous rounds, for consistency.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>abc31 <span class="ot">&lt;-</span> <span class="fu">abc</span>(<span class="at">param =</span> round3a_priors[round3a_metrics<span class="sc">$</span>dc,],</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">sumstat =</span> round3a_metrics <span class="sc">|&gt;</span> <span class="fu">filter</span>(dc) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">7</span>)),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">target =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">tol =</span> <span class="fl">0.01</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">"neuralnet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>12345678910
12345678910</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qsave</span>(abc31, <span class="fu">here</span>(<span class="st">"Data/Validation/abc_round3a.qs"</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(abc31<span class="sc">$</span>ss, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      mg_presence hm_arrival
 [1,]          20      28758
 [2,]          20      29230
 [3,]          20      29202
 [4,]          20      29345
 [5,]          20      28754
 [6,]          20      28669
 [7,]          20      28528
 [8,]          20      29112
 [9,]          20      29166
[10,]          20      28936</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>selected_samples_3 <span class="ot">&lt;-</span> round3a_priors <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="st">"sample"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(abc31<span class="sc">$</span>unadj.values, <span class="at">copy =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(sample)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_sftp_transfer</span>(<span class="st">"/glade/work/pilowskyj/Round3a"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"/Users/julypilowsky/Documents/mgsim/Data/Output/Round3a"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                      selected_samples_3,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">here</span>(<span class="st">"Scripts/Globus/abc_round3a.txt"</span>))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>ensemble_sa <span class="ot">&lt;-</span> <span class="fu">ensemble_mean</span>(selected_samples_3, abc31<span class="sc">$</span>weights, <span class="st">"Sa"</span>, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">animate_sim</span>(ensemble_sa, region, <span class="at">remove_outliers =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/abc_two_metrics-1.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="round3a_analysis_files/figure-html/abc_two_metrics-1.gif" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>This simulation doesn’t look bad, though I definitely need to talk with house finch biologists about the realism of the pattern of finch spread on the landscape.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ensemble_ra <span class="ot">&lt;-</span> <span class="fu">ensemble_mean</span>(selected_samples_3, abc31<span class="sc">$</span>weights, <span class="st">"Ra"</span>, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">animate_sim</span>(ensemble_ra, region, <span class="at">years =</span> <span class="dv">1994</span><span class="sc">:</span><span class="dv">2016</span>, <span class="at">burn_in =</span> <span class="dv">111</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/animate_recovered_adults-1.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="round3a_analysis_files/figure-html/animate_recovered_adults-1.gif" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>The disease dynamics look really cool here, though!</p>
<section id="posterior-distributions" class="level2">
<h2 class="anchored" data-anchor-id="posterior-distributions">Posterior Distributions</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_abc_posteriors</span>(abc31, round2_priors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>✔ split_plot: split into 45 plots across 12 pages</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/optimized%20abc-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="round3a_analysis_files/figure-html/optimized%20abc-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[2]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/optimized%20abc-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="round3a_analysis_files/figure-html/optimized%20abc-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[3]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/optimized%20abc-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="round3a_analysis_files/figure-html/optimized%20abc-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[4]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/optimized%20abc-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="round3a_analysis_files/figure-html/optimized%20abc-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[5]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/optimized%20abc-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="round3a_analysis_files/figure-html/optimized%20abc-5.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[6]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/optimized%20abc-6.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="round3a_analysis_files/figure-html/optimized%20abc-6.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[7]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/optimized%20abc-7.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="round3a_analysis_files/figure-html/optimized%20abc-7.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[8]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/optimized%20abc-8.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="round3a_analysis_files/figure-html/optimized%20abc-8.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[9]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/optimized%20abc-9.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="round3a_analysis_files/figure-html/optimized%20abc-9.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[10]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/optimized%20abc-10.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="round3a_analysis_files/figure-html/optimized%20abc-10.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[11]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/optimized%20abc-11.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="round3a_analysis_files/figure-html/optimized%20abc-11.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
[[12]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/optimized%20abc-12.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="round3a_analysis_files/figure-html/optimized%20abc-12.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="is-it-time-to-stop-modeling" class="level1">
<h1>Is it time to stop modeling?</h1>
<p>We use two checks to see if it’s time to stop modeling: Bayes factors and posterior predictive checks.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bayesfactor_parameters</span>(<span class="at">posterior =</span> <span class="fu">as.data.frame</span>(abc31<span class="sc">$</span>adj.values)[<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>], </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">prior =</span> round3a_priors[<span class="dv">1</span><span class="sc">:</span><span class="dv">45</span>], <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>possible infinite density at lower end
running program with fewer knots
running with maximum degrees of freedom
possible infinite density at upper end
running program with fewer knots
===&gt; warning: knot  2  removed - double knot
possible infinite density at lower end
running program with fewer knots
possible infinite density at upper end
running program with fewer knots
===&gt; warning: knot  2  removed - double knot
possible infinite density at lower end
running program with fewer knots
running with maximum degrees of freedom
possible infinite density at upper end
running program with fewer knots
possible infinite density at lower end
running program with fewer knots
running with maximum degrees of freedom
possible infinite density at upper end
running program with fewer knots
possible infinite density at lower end
running program with fewer knots
running with maximum degrees of freedom
possible infinite density at upper end
running program with fewer knots
===&gt; warning: knot  2  removed - double knot
possible infinite density at lower end
running program with fewer knots
possible infinite density at upper end
running program with fewer knots
===&gt; warning: knot  2  removed - double knot
possible infinite density at lower end
running program with fewer knots
running with maximum degrees of freedom
possible infinite density at upper end
running program with fewer knots
possible infinite density at lower end
running program with fewer knots
running with maximum degrees of freedom
possible infinite density at upper end
running program with fewer knots</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Bayes Factor (Savage-Dickey density ratio)

Parameter                      |        BF
------------------------------------------
dispersal_p_juv                |  4.86e-05
dispersal_p_adult              |  8.47e-12
dispersal_r_juv                |  4.53e-18
dispersal_r_adult              |  2.49e+13
dispersal_source_n_k_cutoff    |     0.016
dispersal_source_n_k_threshold |  5.92e-05
dispersal_target_n_k_cutoff    |  2.27e-13
dispersal_target_n_k_threshold |  3.91e-06
abundance_threshold            |  2.24e-04
initial_release                |  6.27e-13
density_max                    |  1.03e-15
fecundity                      |     0.017
infected_t1                    |  7.68e-06
beta_Sa_winter                 |  1.73e-57
beta_Sa_summer                 | 4.84e-117
beta_I2_modifier               |  0.00e+00
mortality_Sj_winter            |  1.18e-10
mortality_Sa_winter            |  6.16e-10
mortality_Sj_summer            |  1.95e-14
mortality_I1j_winter           |  9.71e-09
mortality_I1j_summer           |  2.77e-59
mortality_I1a_summer           |  1.87e-95
mortality_I1a_winter           |  1.31e-10
mortality_I2_modifier          |     0.002
mortality_I2j_summer           |  2.71e-74
mortality_I2j_winter           |  5.77e-07
mortality_I2a_winter           |  1.35e-57
mortality_I2a_summer           | 3.74e-121
mortality_Rj_summer            |  7.76e-11
mortality_Rj_winter            |  6.67e-08
mortality_Ra_winter            |  1.19e-15
beta_Sj_winter                 |  2.35e-09
beta_Sj_summer                 |  1.52e-06
beta_Ra_winter                 |  6.00e-09
beta_Rj_winter                 | 1.24e-123
beta_Ra_summer                 | 3.20e-151
beta_Rj_summer                 |     0.001
recovery_I1j_summer            |  1.42e-15
recovery_I1a_summer            |  4.78e-19
recovery_I2j_summer            |  2.95e-57
recovery_I2a_summer            |  1.00e-22
recovery_I1j_winter            |  2.13e-22
recovery_I1a_winter            |  6.94e-14
recovery_I2j_winter            | 2.21e-100
recovery_I2a_winter            |  6.92e-30

* Evidence Against The Null: 0</code></pre>
</div>
</div>
<p>Bayes factors look good! They are all well below 1.</p>
<p>The final confirmation is to do posterior predictive checks. The way I do this is to do a small batch of pilot simulations based on the posteriors of round 3, run validation metrics, and make sure that the validation targets fall neatly within the distribution of observed validation metrics.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>pp_metrics <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"Data_minimal/Validation/posterior_predictive_validation_metrics.csv"</span>), <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(<span class="at">model_metrics =</span> pp_metrics <span class="sc">|&gt;</span> <span class="fu">filter</span>(dc) <span class="sc">|&gt;</span> <span class="fu">select</span>(mg_presence, hm_arrival), </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">obs_targets =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  d_obs and d_rep
t = 4366.8, df = 457.57, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 103.8787      Inf
sample estimates:
 mean of x  mean of y 
105.050049   1.132106 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(<span class="at">model_metrics =</span> round3a_metrics <span class="sc">|&gt;</span> <span class="fu">filter</span>(dc) <span class="sc">|&gt;</span> <span class="fu">select</span>(mg_presence, hm_arrival), </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">obs_targets =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  d_obs and d_rep
t = 270.57, df = 3143.6, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 4.897507      Inf
sample estimates:
mean of x mean of y 
 6.600296  1.672825 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(<span class="at">model_metrics =</span> round2_metrics <span class="sc">|&gt;</span> <span class="fu">filter</span>(dc) <span class="sc">|&gt;</span> <span class="fu">select</span>(mg_presence, hm_arrival), </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">obs_targets =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  d_obs and d_rep
t = 2086.7, df = 6999.7, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 23.25405      Inf
sample estimates:
mean of x mean of y 
24.728119  1.455718 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(<span class="at">model_metrics =</span> round1_metrics <span class="sc">|&gt;</span> <span class="fu">filter</span>(dc) <span class="sc">|&gt;</span> <span class="fu">select</span>(mg_presence, hm_arrival), </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">obs_targets =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  d_obs and d_rep
t = 2843.7, df = 4884, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means is greater than 0
95 percent confidence interval:
 41.57898      Inf
sample estimates:
mean of x mean of y 
42.887371  1.284322 </code></pre>
</div>
</div>
<p>None of the rounds pass the posterior predictive check, but round 3 does the best at it, and the additional pilot simulations actually do worse than round 3, which is a strong argument for stopping. However, I think it’s worthwhile to stop and check why round 3 can’t quite meet the target. By which I mean, I want to examine <em>exactly what</em> my best validated model gets wrong.</p>
<section id="what-does-the-best-validated-ensemble-model-get-wrong" class="level2">
<h2 class="anchored" data-anchor-id="what-does-the-best-validated-ensemble-model-get-wrong">What does the best validated ensemble model get wrong?</h2>
<p>I can answer this question by estimating the validation metrics just for the top models selected by ABC in round 3, and looking at what’s correct and what isn’t. I will do this for all of the metrics, even though I only used two for validation.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"Scripts/validated_ensemble_metrics.R"</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>hm_arrival_raster <span class="ot">&lt;-</span> region_raster</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>hm_arrival_raster[hm_arrival_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">is.na</span>(arrival_index)) <span class="sc">|&gt;</span> <span class="fu">pull</span>(region_cell)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">plot</span>(hm_arrival_raster, <span class="at">main =</span> <span class="st">"Places where finches sometimes fail to arrive"</span>, <span class="at">colNA =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/finch_arrival_deep_dive-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="round3a_analysis_files/figure-html/finch_arrival_deep_dive-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>hm_arrival2 <span class="ot">&lt;-</span> region_raster</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>hm_arrival2[hm_arrival_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(arrival_index <span class="sc">&gt;</span> <span class="dv">1</span>, penalty <span class="sc">&gt;</span> <span class="dv">33</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(region_cell)] <span class="ot">&lt;-</span> <span class="dv">2</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">plot</span>(hm_arrival2, <span class="at">main =</span> <span class="st">"Places where finches sometimes arrive too early"</span>, <span class="at">colNA =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/finch_arrival_deep_dive-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="round3a_analysis_files/figure-html/finch_arrival_deep_dive-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>The first plot shows, in green, the locations where in some of the top simulations, we were unable to simulate the finches ever arriving there. The second plot shows, in green, some places where in some of the top simulations, the finches arrive much too early.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>mg_arrival_raster <span class="ot">&lt;-</span> region_raster</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>mg_arrival_raster[mg_arrival_metric <span class="sc">|&gt;</span> <span class="fu">filter</span>(penalty <span class="sc">&gt;</span> <span class="dv">45</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(region_cell)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">plot</span>(mg_arrival_raster, <span class="at">main =</span> <span class="st">"Places where Mycoplasma arrives too early"</span>, <span class="at">colNA =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/mg_arrival_deep_dive-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="round3a_analysis_files/figure-html/mg_arrival_deep_dive-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>The places where the top simulations have MG arriving too early are concentrated in New England.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>point_prevalence_raster <span class="ot">&lt;-</span> region_raster</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>point_prevalence_raster[point_prevalence_metric <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(prevalence), penalty <span class="sc">&gt;</span> <span class="fl">0.1</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(region_cell)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">plot</span>(point_prevalence_raster, <span class="at">main =</span> <span class="st">"Places where simulated prevalence is much too high"</span>, <span class="at">colNA =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/point_prevalence_deep_dive-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="round3a_analysis_files/figure-html/point_prevalence_deep_dive-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>There are not too many places where the simulated prevalence is much too high; the simulations do pretty well on this.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>hm_presence_raster <span class="ot">&lt;-</span> region_raster</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>false_negative <span class="ot">&lt;-</span> hm_presabs_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(always_present, penalty <span class="sc">&gt;</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(region_cell) <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map</span>(\(i) finch_region<span class="sc">$</span>region_indices[i]) <span class="sc">|&gt;</span> <span class="fu">discard</span>(\(v) <span class="fu">length</span>(v) <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">flatten_int</span>()</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>hm_presence_raster[false_negative] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">plot</span>(hm_presence_raster, <span class="at">colNA =</span> <span class="st">"blue"</span>, <span class="at">main =</span> <span class="st">"Places where models fail to simulate continuous finch presence"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/hm_presabs_deep_dive-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="round3a_analysis_files/figure-html/hm_presabs_deep_dive-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>hm_absence_raster <span class="ot">&lt;-</span> region_raster</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>false_positive <span class="ot">&lt;-</span> hm_presabs_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(always_absent, penalty <span class="sc">&gt;</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(region_cell) <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_int</span>(\(i) finch_region<span class="sc">$</span>region_indices[i])</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>hm_absence_raster[false_positive] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">plot</span>(hm_absence_raster, <span class="at">colNA =</span> <span class="st">"blue"</span>, <span class="at">main =</span> <span class="st">"Places where finches are absent but the model simulates presence"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/hm_presabs_deep_dive-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="round3a_analysis_files/figure-html/hm_presabs_deep_dive-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>The places with false negatives (failure to simulate continuous finch presence) are in the West, and the places with false positives are in the South. There are more false negatives than false positives.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mg_presence_raster <span class="ot">&lt;-</span> region_raster</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>mg_presence_raster[mg_presence_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(none_sick) <span class="sc">|&gt;</span> <span class="fu">pull</span>(region_cell)] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">plot</span>(mg_presence_raster, <span class="at">colNA =</span> <span class="st">"blue"</span>, <span class="at">main =</span> <span class="st">"Places where models fail to simulate continuous presence of Mycoplasma"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/mg_presence_deep_dive-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="round3a_analysis_files/figure-html/mg_presence_deep_dive-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Most of the places where the model fails to simulate MG outbreaks are in the West, but it’s not many points; the model does well on this.</p>
</section>
</section>
<section id="time-series" class="level1">
<h1>Time Series</h1>
<p>There are a few aspatial time series I’m interested in looking at from the top validated models. First, I want to see an overall trajectory of house finch population size.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>sim_weights <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sim =</span> selected_samples_3, <span class="at">weight =</span> abc31<span class="sc">$</span>weights)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>ensemble_model <span class="ot">&lt;-</span> <span class="fu">ensemble_time_series</span>(selected_samples_3, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(sim_weights, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Simulation"</span> <span class="ot">=</span> <span class="st">"sim"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Simulation =</span> <span class="fu">factor</span>(Simulation))</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Sum across compartments/life stages per simulation/time</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>ensemble_by_sim_time <span class="ot">&lt;-</span> ensemble_model <span class="sc">|&gt;</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Time, Simulation, weight) <span class="sc">|&gt;</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Abundance =</span> <span class="fu">sum</span>(Abundance), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate weighted average by time</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>weighted_average <span class="ot">&lt;-</span> ensemble_by_sim_time <span class="sc">|&gt;</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Time) <span class="sc">|&gt;</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Abundance =</span> <span class="fu">weighted.mean</span>(Abundance, weight), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> ensemble_by_sim_time <span class="sc">|&gt;</span> </span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidyplot</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Abundance, <span class="at">group =</span> Simulation) <span class="sc">|&gt;</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_sum_line</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_annotation_line</span>(<span class="at">x =</span> <span class="dv">1994</span>, <span class="at">xend =</span> <span class="dv">1994</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="fl">6e08</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_annotation_text</span>(<span class="at">x =</span> <span class="dv">1994</span>, <span class="at">y =</span> <span class="fl">6e08</span>, <span class="at">text =</span> <span class="st">"MG start"</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_title</span>(<span class="st">"Ensemble Finch Population Size Time Series"</span>)</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> weighted_average, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Abundance, <span class="at">group =</span> <span class="cn">NA</span>), </span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/population_size_ts-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="round3a_analysis_files/figure-html/population_size_ts-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>What’s interesting here is that the seasonal variation in population size reduces after the introduction of MG.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>weighted_average2 <span class="ot">&lt;-</span> ensemble_model <span class="sc">|&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Year <span class="sc">&gt;</span> <span class="dv">1993</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Infected =</span> <span class="fu">str_detect</span>(Compartment, <span class="st">"I"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Infected, Time, Simulation, weight) <span class="sc">|&gt;</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">Abundance =</span> <span class="fu">sum</span>(Abundance), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Infected, Time) <span class="sc">|&gt;</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">Abundance =</span> <span class="fu">weighted.mean</span>(Abundance, weight), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Infected, <span class="at">values_from =</span> Abundance, <span class="at">names_prefix =</span> <span class="st">"Infected"</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Prevalence =</span> InfectedTRUE<span class="sc">/</span>(InfectedTRUE <span class="sc">+</span> InfectedFALSE))</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>prevalence_df <span class="ot">&lt;-</span> ensemble_model <span class="sc">|&gt;</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Year <span class="sc">&gt;</span> <span class="dv">1993</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Infected =</span> <span class="fu">str_detect</span>(Compartment, <span class="st">"I"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Infected, Time, Simulation) <span class="sc">|&gt;</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">Abundance =</span> <span class="fu">sum</span>(Abundance), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Infected, <span class="at">values_from =</span> Abundance, <span class="at">names_prefix =</span> <span class="st">"Infected"</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Prevalence =</span> InfectedTRUE<span class="sc">/</span>(InfectedTRUE <span class="sc">+</span> InfectedFALSE))</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> prevalence_df <span class="sc">|&gt;</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidyplot</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Prevalence, <span class="at">group =</span> Simulation) <span class="sc">|&gt;</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_line</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">adjust_y_axis</span>(<span class="at">transform =</span> <span class="st">"log10"</span>) <span class="sc">|&gt;</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_title</span>(<span class="st">"Ensemble MG Prevalence Time Series (Log Scale)"</span>)</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>p2 <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> weighted_average2, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> Prevalence, <span class="at">group =</span> <span class="cn">NA</span>), </span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/prevalence_ts-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="round3a_analysis_files/figure-html/prevalence_ts-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>The simulations where everything ends up at 100% prevalence from 2005 onward are somewhat concerning and I’ll have to investigate them later. Let’s have a look at number of cases of conjunctivitis over time:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>weighted_average3 <span class="ot">&lt;-</span> ensemble_model <span class="sc">|&gt;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Year <span class="sc">&gt;</span> <span class="dv">1993</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Infected =</span> <span class="fu">str_detect</span>(Compartment, <span class="st">"I"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Infected, Time, Simulation, weight) <span class="sc">|&gt;</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">Abundance =</span> <span class="fu">sum</span>(Abundance), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Infected, Time) <span class="sc">|&gt;</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">Abundance =</span> <span class="fu">weighted.mean</span>(Abundance, weight), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Infected, <span class="at">values_from =</span> Abundance, <span class="at">names_prefix =</span> <span class="st">"Infected"</span>)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> ensemble_model <span class="sc">|&gt;</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Year <span class="sc">&gt;</span> <span class="dv">1993</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Infected =</span> <span class="fu">str_detect</span>(Compartment, <span class="st">"I"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Infected, Time, Simulation) <span class="sc">|&gt;</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">Abundance =</span> <span class="fu">sum</span>(Abundance), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Infected, <span class="at">values_from =</span> Abundance, <span class="at">names_prefix =</span> <span class="st">"Infected"</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidyplot</span>(<span class="at">x =</span> Time, <span class="at">y =</span> InfectedTRUE, <span class="at">group =</span> Simulation) <span class="sc">|&gt;</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_line</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">adjust_y_axis_title</span>(<span class="st">"MG Cases"</span>) <span class="sc">|&gt;</span></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_title</span>(<span class="st">"Ensemble MG Cases Time Series"</span>)</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>p3 <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> weighted_average3, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> InfectedTRUE, <span class="at">group =</span> <span class="cn">NA</span>), </span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/case_ts-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img src="round3a_analysis_files/figure-html/case_ts-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="prevalence-animations" class="level1">
<h1>Prevalence Animations</h1>
<p>Based on the prevalence trajectories I saw in the time series, I would like to create animations of prevalence in a few individual simulations representing different prevalence trajectories through time, to get a sense of what happens in each.</p>
<section id="weighted-ensemble-average" class="level2">
<h2 class="anchored" data-anchor-id="weighted-ensemble-average">Weighted Ensemble Average</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>ensemble_sa <span class="ot">&lt;-</span> <span class="fu">ensemble_mean</span>(selected_samples_3, abc31<span class="sc">$</span>weights, <span class="st">"Sa"</span>, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>ensemble_ra <span class="ot">&lt;-</span> <span class="fu">ensemble_mean</span>(selected_samples_3, abc31<span class="sc">$</span>weights, <span class="st">"Ra"</span>, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>))</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>ensemble_sj <span class="ot">&lt;-</span> <span class="fu">ensemble_mean</span>(selected_samples_3, abc31<span class="sc">$</span>weights, <span class="st">"Sj"</span>, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>ensemble_rj <span class="ot">&lt;-</span> <span class="fu">ensemble_mean</span>(selected_samples_3, abc31<span class="sc">$</span>weights, <span class="st">"Rj"</span>, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>))</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>ensemble_I1a <span class="ot">&lt;-</span> <span class="fu">ensemble_mean</span>(selected_samples_3, abc31<span class="sc">$</span>weights, <span class="st">"I1a"</span>, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>))</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>ensemble_I2a <span class="ot">&lt;-</span> <span class="fu">ensemble_mean</span>(selected_samples_3, abc31<span class="sc">$</span>weights, <span class="st">"I2a"</span>, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>))</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>ensemble_I1j <span class="ot">&lt;-</span> <span class="fu">ensemble_mean</span>(selected_samples_3, abc31<span class="sc">$</span>weights, <span class="st">"I1j"</span>, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>))</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>ensemble_I2j <span class="ot">&lt;-</span> <span class="fu">ensemble_mean</span>(selected_samples_3, abc31<span class="sc">$</span>weights, <span class="st">"I2j"</span>, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>))</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>prevalence_array <span class="ot">&lt;-</span> (ensemble_I1a <span class="sc">+</span> ensemble_I2a <span class="sc">+</span> ensemble_I1j <span class="sc">+</span> ensemble_I2j)<span class="sc">/</span>(ensemble_sa <span class="sc">+</span> ensemble_ra <span class="sc">+</span> ensemble_sj <span class="sc">+</span> ensemble_rj <span class="sc">+</span> ensemble_I1a <span class="sc">+</span> ensemble_I2a <span class="sc">+</span> ensemble_I1j <span class="sc">+</span> ensemble_I2j)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="fu">animate_sim</span>(prevalence_array, region, <span class="at">years =</span> <span class="dv">1994</span><span class="sc">:</span><span class="dv">2016</span>, <span class="at">burn_in =</span> <span class="dv">111</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/weighted_average_prevalence-1.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="round3a_analysis_files/figure-html/weighted_average_prevalence-1.gif" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Yes, the present-day prevalence is much too high in the weighted ensemble mean. I suspect there is a problem coming from the fact that most of my spatiotemporal prevalence data is from before 2003, so it doesn’t capture the fact that prevalence stopped increasing after a certain date. I wonder if I can find more recent prevalence data…</p>
</section>
<section id="simulation-7649" class="level2">
<h2 class="anchored" data-anchor-id="simulation-7649">Simulation 7649</h2>
<p>This is a simulation that does <em>not</em> hit 100% prevalence, providing an alternative trajectory to look at.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prevalence_sim</span>(<span class="dv">7649</span>, region, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>), <span class="at">biclass =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
has missing values, omitted in finding classes</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): N is
large, and some styles will run very slowly; sampling imposed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
has missing values, omitted in finding classes</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): N is
large, and some styles will run very slowly; sampling imposed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prevalence_sim</span>(<span class="dv">7649</span>, region, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/prevalence_anim_7649-1.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="round3a_analysis_files/figure-html/prevalence_anim_7649-1.gif" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="simulation-9673" class="level2">
<h2 class="anchored" data-anchor-id="simulation-9673">Simulation 9673</h2>
<p>This simulation also does not hit 100% prevalence; in fact, it eventually gets to zero.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prevalence_sim</span>(<span class="dv">9673</span>, region, <span class="fu">here</span>(<span class="st">"Data/Output/Round3a"</span>), <span class="at">biclass =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
has missing values, omitted in finding classes</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): N is
large, and some styles will run very slowly; sampling imposed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): var
has missing values, omitted in finding classes</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in classInt::classIntervals(.data[[var]], n = dim, style = style): N is
large, and some styles will run very slowly; sampling imposed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: attribute variables are assumed to be spatially constant throughout
all geometries</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="round3a_analysis_files/figure-html/prevalence_anim_9673-1.gif" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img src="round3a_analysis_files/figure-html/prevalence_anim_9673-1.gif" class="img-fluid figure-img"></a></p>
</figure>
</div>
</div>
</div>
<p>Wow, okay, this is one is wild. That’s definitely not what happened.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>